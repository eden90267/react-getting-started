# temp

若是節點依然存在，但是節點類型發生改變，React 同樣也會直接摘除該節點，並建立一個新的，而不會繼續往下比較它的子節點。如下圖所示，兩個 DOM 結構相似，僅僅是將節點 D 替換成節點 G：

![](https://imgur.com/zint7nQ.png)

React 判斷到節點 D 與節點 G 為不同類型的元件，就會直接將節點 D 移除，重新建立節點 G 與其之下的子節點。大部分情況下兩個不同節點類型一般會產生不一樣的 DOM 結構，因此 React 認為直接建立一個新的節點會比起繼續操作 diff 來得有效率。

這樣做法或許比較粗糙，但是也降低了 Diffing 演算法的複雜性，React 只需要將整顆虛擬 DOM 樹遍歷過一次，就可以完成比較，找出之間的差異。然而，這樣的作法也提醒我們，在實作元件時，需要保持 DOM 結構的穩定性，避免 React 重複地在建立與刪除元件，降低整體效能。

前面介紹過對於不同層級的比較，React 的作法就是建立予刪除。現在要說明的是節點位於同層級的處理方式，React 的 diffing 演算法對於同層級的節點提供了三種操作：

- INSERT_MARKUP (插入)：節點為全新的，需要插入原有的集合中
- MOVE_EXISTING (移動)：節點已存在於集合中，只是位置發生變化，則需要執行移動操作
- REMOVE_NODE (刪除)：節點已經不存在於集合中，需要將其移除

如下圖所示，若是要在原有的集合中加入一個新節點：

![](https://imgur.com/vn9WX8J.png)

這種情況下，React 的作法是逐個節點作比較，當比對到 C 節點的時候，發現新集合的 E 節點不等於 C 節點，因此他會刪除原本的 C 節點，建立並插入 E 節點到新的集合，在重新建立後面的 C 節點並插入，以此類推。

由於新的集合中只是插入了一個新節點，並不需要這麼繁瑣的程序去將後面那些節點全部移除重建，建立新的集合，這樣的作法會影響更新的效能。因此，React 也提出了改善策略，它提供了 **key 屬性**，**幫助集合中的節點作定位分析**，**再進行比較**。以前面的範例作說明，為每個節點加上 key 屬性後，React 就能直接建立新節點並將它插入到正確的位置，而不需要一一重建，如下圖所示：

![](https://imgur.com/FpkqpMq.png)

以上就是關於 React Diffing 演算法的介紹，總結來說，還是要在開發時確保 DOM 結構的穩定性，避免數量過大或是太頻繁的節點操作，影響 React 渲染的性能。

## 使用 JSX 與 Component 的好處

眾所皆知，元件化是 React 的開發思想，Component 就是構成前端視覺化頁面的一切基礎，正如同前面章節 JSX 基礎語法所提到的，React 認為網頁元件的關注點不應該被分離為視圖與行為邏輯，而是應該建構一個獨立的元件，將視圖與行為邏輯都封裝到元件中。

React Component 的建立主要可以分為以下兩種：

- 使用 ES6 Class 建立 Component

  ```javascript
  class MyApp extends React.Component {
    render() {
      return (
        <div>
          <h1>Hello World!</h1>
        </div>
      );
    }
  }
  ```

- 建立 Pure Component

  ```javascript
  const MyApp = () => {
    return (
      <div>
        <h1>Hello World!</h1>
      </div>
    );
  }
  ```

兩者的差別是，使用 Component 這個 class 建立的元件具有 state 與生命週期，可以對它做較複雜的操作。而 Pure Component 則是指那些無狀態元件，沒有 state、生命週期方法，不需要處理資料或是元件內部的狀態變化，只單純的渲染元件的前端 UI 視圖。在適當的情況下，官方也推崇多使用 Pure Component 的作法，以提高整體效能。

現在一個 Component 該有的結構、樣式、行為全部被封裝在一起了，但是應該如何在元件內部建立它的結構呢? 在傳統的前端頁面中，我們會使用 HTML 將整個網頁結構建立出來，而在 React 中，則是提供了你像是 createElement() 這類的 API 去建立網頁元素，但是使用這種作法對於習慣使用 HTML 的開發人員非常不直覺，而且當元件變得複雜時，程式碼也會看起來很繁瑣冗長，不易於維護。

因為上述的問題，而誕生 JSX，JSX 其實就是一種語法糖衣，它類似於 XML 語法，讓熟悉 HTML 的開發人員都可以輕鬆地使用 JSX 去建立網頁元素，並透過 Babel 轉譯器將它轉換成 JavaScript，簡單來說，就是讓開發者感覺就像在寫傳統的 HTML，但其實他寫的是 JavaScript。JSX 不僅讓開發者使用起來更直覺，更增加了整體程式碼的可讀性，特別是在大型專案中，JSX 提供了你一種更乾淨、簡潔的方式去描述元件樹，讓你無痛將元件的行為邏輯與結構封裝起來，這就是 JSX 與 Component 所帶來的好處。